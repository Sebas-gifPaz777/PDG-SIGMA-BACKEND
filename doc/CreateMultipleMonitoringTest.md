# Diseño de Pruebas: MonitoringController - Creación Masiva (CreateMultipleMonitoringsTest)

Este documento detalla los casos de prueba implementados en la clase `CreateMultipleMonitoringsTest` para verificar la funcionalidad del endpoint de creación masiva de monitorías (`/monitoring/createAll/{id}`) en `MonitoringController`.

**Objetivo:** Validar que el controlador maneja correctamente las solicitudes de carga de archivos (Excel) para la creación múltiple de monitorías, interactuando adecuadamente con `MonitoringServiceImpl` y gestionando tanto los casos de éxito como los de error esperados (archivo inválido, profesor no encontrado, etc.).

**Alcance:** Pruebas unitarias/de integración ligera del endpoint `/monitoring/createAll/{id}` utilizando `@WebMvcTest` y Mocks para el servicio y repositorios (aunque los mocks de repositorios no son estrictamente necesarios aquí, ya que el servicio está mockeado).

**Estrategia:** Simular peticiones HTTP `multipart/form-data` utilizando `MockMvc`. Configurar el mock de `MonitoringServiceImpl` para devolver resultados esperados o lanzar excepciones según el escenario. Verificar los códigos de estado HTTP y los cuerpos de respuesta.

## Casos de Prueba (Implementados en `CreateMultipleMonitoringsTest`)

### 1. Carga y Procesamiento de Archivo Excel

| ID Caso  | Nombre del Test (Método)                   | Descripción                                                                                | Precondiciones (Mocks)                                                                   | Pasos                                                                                                                               | Resultado Esperado                                                                                                                              | Estado |
| :------- | :----------------------------------------- | :----------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| MON-CM-001 | `testProcessListMonitor_Success`         | Verifica el procesamiento exitoso de un archivo Excel válido para crear monitorías.        | `monitoringService.processListMonitor` devuelve mensaje de éxito "Todas las monitorias..." | 1. Crear `MockMultipartFile` válido. 2. Configurar Mock del servicio. 3. Realizar petición `multipart` a `/monitoring/createAll/{id}`. | Status HTTP 200 (OK). Cuerpo de la respuesta contiene el mensaje de éxito devuelto por el servicio.                                             | OK     |
| MON-CM-002 | `testProcessListMonitor_EmptyFile`       | Verifica el manejo de un archivo Excel vacío o con formato inicial incorrecto.           | `monitoringService.processListMonitor` lanza `Exception` ("Incompatibilidad...")       | 1. Crear `MockMultipartFile` vacío. 2. Configurar Mock del servicio para lanzar excepción. 3. Realizar petición `multipart`.          | Status HTTP 500 (Internal Server Error). Cuerpo de la respuesta contiene el mensaje de error formateado por el controlador ("Error al procesar..."). | OK     |
| MON-CM-003 | `testProcessListMonitor_InvalidColumns`  | Verifica el manejo de un archivo Excel con nombres de columna incorrectos o faltantes.     | `monitoringService.processListMonitor` lanza `Exception` ("Incompatibilidad...")       | 1. Crear `MockMultipartFile` con contenido inválido. 2. Configurar Mock del servicio para lanzar excepción. 3. Realizar petición `multipart`. | Status HTTP 500 (Internal Server Error). Cuerpo de la respuesta contiene el mensaje de error formateado por el controlador.                          | OK     |
| MON-CM-004 | `testProcessListMonitor_ProfessorNotFound`| Verifica el manejo cuando el ID del profesor proporcionado en la URL no es encontrado.   | `monitoringService.processListMonitor` lanza `Exception` ("Profesor no encontrado")    | 1. Crear `MockMultipartFile` válido. 2. Configurar Mock del servicio para lanzar excepción. 3. Realizar petición `multipart`.          | Status HTTP 500 (Internal Server Error). Cuerpo de la respuesta contiene el mensaje de error formateado por el controlador.                          | OK     |
| MON-CM-005 | N/A                                        | Verifica el manejo de errores internos durante el procesamiento (ej. fallo al guardar). | `monitoringService.processListMonitor` lanza `RuntimeException` u otra no esperada.      | 1. Crear `MockMultipartFile` válido. 2. Configurar Mock del servicio para lanzar `RuntimeException`. 3. Realizar petición `multipart`. | Status HTTP 500 (Internal Server Error). Cuerpo de la respuesta contiene un mensaje de error genérico.                                            | Pendiente |
| MON-CM-006 | N/A                                        | Verifica el manejo de un tipo de archivo incorrecto (no Excel).                            | - (El controlador o Spring podrían rechazarlo antes de llamar al servicio)                 | 1. Crear `MockMultipartFile` con `contentType` incorrecto. 2. Realizar petición `multipart`.                                        | Status HTTP 400 (Bad Request) o 415 (Unsupported Media Type).                                                                                 | Pendiente |
| MON-CM-007 | N/A                                        | Verifica el manejo si no se proporciona el archivo (`file` es null o no está presente).  | -                                                                                        | 1. Realizar petición `multipart` sin adjuntar el archivo `file`.                                                                    | Status HTTP 400 (Bad Request) indicando que falta el parámetro requerido.                                                                     | Pendiente |

---

**Notas:**

*   Los tests utilizan `MockMvcRequestBuilders.multipart` para simular la carga de archivos.
*   Se crean `MockMultipartFile` para representar los archivos subidos en diferentes escenarios (válido, vacío, inválido). Los métodos `getValidExcelFileContent()` y `getInvalidColumnsExcelFileContent()` simulan el contenido en bytes (en un test real, podrías leer archivos de ejemplo desde los recursos).
*   Se mockea `MonitoringServiceImpl` para aislar el controlador de la lógica real de procesamiento del archivo, permitiendo simular diferentes resultados y excepciones del servicio.
*   Se verifica el código de estado HTTP y el contenido del cuerpo de la respuesta para cada escenario.
*   Las rutas en `mockMvc.perform` son relativas al contexto de la aplicación (`/monitoring/createAll/{id}`).
