# Diseño de Pruebas: ActivityController - Obtener Lista de Actividades (GetActivitiesListTest)

Este documento describe los casos de prueba implementados en la clase `GetActivitiesListTest` para verificar la funcionalidad del endpoint `/activity/findAll/{userId}/{role}` en `ActivityController`, responsable de obtener la lista de actividades relevantes para un usuario según su rol.

**Objetivo:** Validar que el controlador maneja correctamente las solicitudes para obtener listas de actividades, interactúa adecuadamente con `ActivityService` (y otros servicios/repositorios si el rol es 'jfedpto'), y gestiona los casos de éxito y error (ej. usuario sin actividades).

**Alcance:** Pruebas de integración ligera del endpoint `/activity/findAll/{userId}/{role}` utilizando `@SpringBootTest` y `@AutoConfigureMockMvc`. Se mockean las dependencias (`ActivityService`, `CourseServiceImpl`, etc.) para aislar la prueba del controlador y la lógica específica del endpoint. *Nota: Aunque `@SpringBootTest` carga más contexto, los mocks evitan la interacción real con la base de datos para estos tests específicos.*

**Estrategia:** Simular peticiones HTTP GET utilizando `MockMvc`. Configurar el mock de `ActivityService` para devolver listas de `ActivityDTO` o lanzar excepciones según el escenario. Verificar los códigos de estado HTTP y el contenido de las respuestas JSON.

## Casos de Prueba (Implementados en `GetActivitiesListTest`)

### 1. Obtención de Actividades por Usuario y Rol

| ID Caso  | Nombre del Test (Método)                      | Descripción                                                                                   | Precondiciones (Mocks)                                                            | Pasos                                                                                             | Resultado Esperado                                                                                                                                                            | Estado |
| :------- | :-------------------------------------------- | :-------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| ACT-GA-001 | `testGetActivitiesPerUser_Monitor_Success`    | Verifica la obtención exitosa de la lista de actividades para un usuario con rol 'monitor'. | `activityService.findAll("123", "monitor")` devuelve una lista con 2 `ActivityDTO`. | 1. Definir `userId` y `role`. 2. Configurar Mock del servicio. 3. Realizar petición GET a `/activity/findAll/{userId}/{role}`. | Status HTTP 200 (OK). Cuerpo JSON contiene un array con 2 objetos, verificando ID y nombre de cada uno (`jsonPath`).                                                               | OK     |
| ACT-GA-002 | `testGetActivitiesPerUser_Professor_Success`  | Verifica la obtención exitosa de la lista de actividades para un usuario con rol 'professor'. | `activityService.findAll("456", "professor")` devuelve una lista con 1 `ActivityDTO`. | 1. Definir `userId` y `role`. 2. Configurar Mock del servicio. 3. Realizar petición GET.      | Status HTTP 200 (OK). Cuerpo JSON contiene un array con 1 objeto, verificando ID y nombre (`jsonPath`).                                                                       | OK     |
| ACT-GA-003 | `testGetActivitiesPerUser_NotFound`           | Verifica el manejo cuando el servicio indica que no hay actividades para el usuario/rol dado. | `activityService.findAll("999", "monitor")` lanza `Exception("No actividades...")`.   | 1. Definir `userId` y `role`. 2. Configurar Mock del servicio para lanzar excepción. 3. Realizar petición GET. | Status HTTP 404 (Not Found). Cuerpo de la respuesta contiene el mensaje de error devuelto por el servicio (`content().string(...)`).                                                | OK     |
| ACT-GA-004 | N/A                                           | Verifica la obtención exitosa para el rol 'jfedpto'.                                          | Configurar mocks para `departmentHeadService`, `courseService`, `courseProfessorRepository`, `activityService.findAll` (llamado múltiples veces). | 1. Definir `userId` y `role="jfedpto"`. 2. Configurar Mocks necesarios para la lógica del 'jfedpto'. 3. Realizar petición GET. | Status HTTP 200 (OK). Cuerpo JSON contiene la lista agregada y filtrada de actividades según la lógica del controlador.                                                              | Pendiente |
| ACT-GA-005 | N/A                                           | Verifica el caso 'jfedpto' cuando no se encuentran programas/cursos/profesores asociados.   | Configurar mocks para que devuelvan listas vacías en pasos intermedios de la lógica 'jfedpto'. | 1. Definir `userId` y `role="jfedpto"`. 2. Configurar Mocks para devolver vacío. 3. Realizar petición GET.        | Status HTTP 200 (OK). Cuerpo JSON contiene un array vacío (`[]`).                                                                                                             | Pendiente |
| ACT-GA-006 | N/A                                           | Verifica el manejo de un rol inválido o no soportado.                                       | - (La lógica del controlador puede o no manejar roles desconocidos explícitamente).      | 1. Definir `userId` y `role="invalid_role"`. 2. Realizar petición GET.                                             | Status HTTP 404 (Not Found) o 400 (Bad Request) dependiendo de la implementación, o podría caer en el caso `else` y llamar a `activityService.findAll` con el rol inválido. | Pendiente |
| ACT-GA-007 | N/A                                           | Verifica el caso cuando el servicio devuelve una lista vacía (no una excepción).           | `activityService.findAll(userId, role)` devuelve `Collections.emptyList()`.       | 1. Definir `userId` y `role`. 2. Configurar Mock del servicio. 3. Realizar petición GET.                      | Status HTTP 200 (OK). Cuerpo JSON contiene un array vacío (`[]`).                                                                                                             | Pendiente |

---

**Notas:**

*   Los tests utilizan `@SpringBootTest` y `@AutoConfigureMockMvc`, lo que carga más contexto que `@WebMvcTest`, pero los mocks aseguran que no se interactúe con la base de datos real para *estos* tests específicos. Si se quisiera optimizar, se podría usar `@WebMvcTest(ActivityController.class)` y mockear `DepartmentHeadServiceImpl`, `CourseServiceImpl`, etc., además de `ActivityService`.
*   Se mockea `ActivityService` para controlar directamente lo que devuelve la llamada principal para los roles 'monitor' y 'professor'.
*   Se verifica el código de estado HTTP y se usa `jsonPath` para inspeccionar la estructura y contenido del cuerpo JSON de la respuesta.
*   Los casos para el rol 'jfedpto' son más complejos de mockear porque involucran múltiples llamadas a diferentes servicios/repositorios dentro de la lógica del controlador. Estos casos están marcados como "Pendiente" y requerirían una configuración de mocks más elaborada.

Este diseño cubre los flujos básicos probados en `GetActivitiesListTest` para los roles 'monitor' y 'professor', incluyendo el caso de error donde no se encuentran actividades.