# Diseño de Pruebas: ActivityServiceImpl

Este documento describe los casos de prueba diseñados para verificar la funcionalidad de la clase `ActivityServiceImpl`, enfocándose en la lógica de negocio relacionada con la creación, actualización y asignación de roles en las actividades. Los tests unitarios correspondientes se encuentran en la clase `ActivityTest`.

**Objetivo:** Asegurar que `ActivityServiceImpl` maneja correctamente la creación, actualización y recuperación de entidades `Activity`, así como la asignación de roles y entidades relacionadas (Monitor, Professor, Monitoring), y gestiona adecuadamente los casos de error.

**Alcance:** Pruebas unitarias de los métodos públicos de `ActivityServiceImpl`, utilizando Mocks para las dependencias (Repositorios). No se prueban las interacciones reales con la base de datos.

**Estrategia:** Pruebas de caja blanca basadas en la estructura del código y pruebas de caja negra basadas en los requerimientos funcionales (crear, actualizar, buscar, eliminar actividades). Se utilizan aserciones para verificar los resultados esperados y el manejo de excepciones.

## Casos de Prueba

A continuación, se detallan los casos de prueba diseñados e implementados en `ActivityTest`:

---

### 1. Asignación de Roles

Estos casos prueban la capacidad de asignar diferentes combinaciones de `Monitor` y `Professor` a una entidad `Activity` (aunque la lógica reside principalmente en los setters de la entidad `Activity`, estos tests verifican la interacción básica).

| ID Caso | Nombre del Test (Método)                             | Descripción                                                                                                | Precondiciones                                      | Pasos                                                                                        | Resultado Esperado                                                                                                     | Estado   |
| :------ | :--------------------------------------------------- | :--------------------------------------------------------------------------------------------------------- | :-------------------------------------------------- | :------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------- | :------- |
| ACT-001 | `testAssignRoles_MonitorCreator_ProfessorResponsible` | Verifica que se puedan asignar un Monitor y un Profesor a una actividad.                                   | -                                                   | 1. Crear `Activity`. 2. Crear `Monitor`. 3. Crear `Professor`. 4. Asignar `Monitor` y `Professor` a `Activity`. | La actividad debe tener asociados el Monitor y el Profesor correctos (`assertEquals`).                               | OK       |
| ACT-002 | `testAssignRoles_ProfessorCreator_MonitorResponsible` | Verifica la asignación inversa de roles (Profesor creador implícito, Monitor responsable).                   | -                                                   | 1. Crear `Activity`. 2. Crear `Professor`. 3. Crear `Monitor`. 4. Asignar `Professor` y `Monitor` a `Activity`. | La actividad debe tener asociados el Profesor y el Monitor correctos (`assertEquals`).                               | OK       |
| ACT-003 | `testAssignRoles_MonitorCreator_MonitorResponsible`   | Verifica que se pueda asignar solo un Monitor (Profesor es null).                                          | -                                                   | 1. Crear `Activity`. 2. Crear `Monitor`. 3. Asignar `Monitor` a `Activity`. 4. Asignar `null` como `Professor`.    | La actividad debe tener el Monitor correcto y el Profesor debe ser `null` (`assertEquals`, `assertNull`).            | OK       |
| ACT-004 | `testAssignRoles_ProfessorCreator_ProfessorResponsible` | Verifica que se pueda asignar solo un Profesor (Monitor es null).                                          | -                                                   | 1. Crear `Activity`. 2. Crear `Professor`. 3. Asignar `Professor` a `Activity`. 4. Asignar `null` como `Monitor`.    | La actividad debe tener el Profesor correcto y el Monitor debe ser `null` (`assertEquals`, `assertNull`).            | OK       |

---

### 2. Creación de Actividad (`save` con `NewActivityRequestDTO`)

Estos casos (actualmente comentados en `ActivityTest`) verificarían la lógica de creación de una nueva actividad a partir de un DTO.

| ID Caso | Nombre del Test (Método) | Descripción                                                                        | Precondiciones (Mocks)                                                                                                                                | Pasos                                                                                                                          | Resultado Esperado                                                                                                                                                                | Estado         |
| :------ | :----------------------- | :--------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- |
| ACT-005 | `testSave_NewActivity`   | Verifica la creación exitosa de una actividad cuando todos los datos son válidos. | `monitoringRepository.findById` devuelve Monitoring. `monitorRepository.findByIdMonitor` devuelve Monitor. `professorRepository.findById` devuelve Professor. `activityRepository.save` devuelve la actividad guardada. | 1. Crear `NewActivityRequestDTO` válido. 2. Configurar Mocks. 3. Llamar a `activityService.save(dto)`. 4. Verificar resultado. | Se devuelve un `ActivityDTO` no nulo, con los datos correspondientes a la actividad guardada (ej. nombre, estado PENDIENTE, IDs correctos). La llamada a `activityRepository.save` ocurre. | Comentado / OK |
| ACT-006 | N/A                      | Verifica el fallo al crear si la Monitoría no existe.                              | `monitoringRepository.findById` devuelve `Optional.empty()`.                                                                                          | 1. Crear DTO. 2. Configurar Mock `monitoringRepository`. 3. Llamar a `activityService.save(dto)`.                           | Se lanza una `Exception` con mensaje indicando que la monitoría no fue encontrada.                                                                                              | Pendiente      |
| ACT-007 | N/A                      | Verifica el fallo al crear si el Monitor asignado no existe (si aplica).           | `monitoringRepository.findById` OK. `monitorRepository.findByIdMonitor` devuelve `Optional.empty()`.                                                  | 1. Crear DTO. 2. Configurar Mocks. 3. Llamar a `activityService.save(dto)`.                                                 | Se lanza una `Exception` con mensaje indicando que el monitor no fue encontrado.                                                                                                  | Pendiente      |
| ACT-008 | N/A                      | Verifica el fallo al crear si el Profesor asignado no existe (si aplica).          | `monitoringRepository.findById` OK. `professorRepository.findById` devuelve `Optional.empty()`.                                                       | 1. Crear DTO. 2. Configurar Mocks. 3. Llamar a `activityService.save(dto)`.                                                 | Se lanza una `Exception` con mensaje indicando que el profesor no fue encontrado.                                                                                                 | Pendiente      |

---

### 3. Actualización de Actividad (`update` con `ActivityRequestDTO`)

Estos casos (actualmente comentados en `ActivityTest`) verificarían la lógica de actualización de una actividad existente.

| ID Caso | Nombre del Test (Método)       | Descripción                                                                                   | Precondiciones (Mocks)                                                                                                                                                             | Pasos                                                                                                                               | Resultado Esperado                                                                                                                                                                               | Estado         |
| :------ | :----------------------------- | :-------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------- |
| ACT-009 | `testUpdate_ExistingActivity`  | Verifica la actualización exitosa de una actividad existente con datos válidos.               | `activityRepository.findById` devuelve Activity existente. `monitoringRepository.findById` devuelve Monitoring actualizado. `monitorRepository.findByIdMonitor` OK. `professorRepository.findById` OK. `activityRepository.save` devuelve la actividad actualizada. | 1. Crear `ActivityRequestDTO` con datos actualizados. 2. Configurar Mocks. 3. Llamar a `activityService.update(dto)`. 4. Verificar resultado. | Se devuelve un `ActivityDTO` no nulo con los datos actualizados (nombre, estado, IDs). La llamada a `activityRepository.save` ocurre con el objeto actualizado.                             | Comentado / OK |
| ACT-010 | `testUpdate_ActivityNotFound`  | Verifica que se lanza una excepción si se intenta actualizar una actividad que no existe.    | `activityRepository.findById` devuelve `Optional.empty()`.                                                                                                                         | 1. Crear `ActivityRequestDTO` con ID inexistente. 2. Configurar Mock `activityRepository`. 3. Llamar a `activityService.update(dto)`. | Se lanza una `Exception` (o la específica definida en el servicio). Se verifica el mensaje de error esperado. La llamada a `activityRepository.save` *no* debe ocurrir.                        | OK             |
| ACT-011 | N/A                          | Verifica el fallo al actualizar si la nueva Monitoría asignada no existe.                    | `activityRepository.findById` OK. `monitoringRepository.findById` (con nuevo ID) devuelve `Optional.empty()`.                                                                        | 1. Crear DTO con ID de monitoría inválido. 2. Configurar Mocks. 3. Llamar a `activityService.update(dto)`.                        | Se lanza una `Exception` indicando que la monitoría no fue encontrada.                                                                                                                           | Pendiente      |
| ACT-012 | N/A                          | Verifica el fallo al actualizar si el nuevo Monitor asignado no existe (si aplica).           | `activityRepository.findById` OK. `monitoringRepository.findById` OK. `monitorRepository.findByIdMonitor` (con nuevo ID) devuelve `Optional.empty()`.                               | 1. Crear DTO con ID de monitor inválido. 2. Configurar Mocks. 3. Llamar a `activityService.update(dto)`.                           | Se lanza una `Exception` indicando que el monitor no fue encontrado.                                                                                                                             | Pendiente      |
| ACT-013 | N/A                          | Verifica el fallo al actualizar si el nuevo Profesor asignado no existe (si aplica).          | `activityRepository.findById` OK. `monitoringRepository.findById` OK. `professorRepository.findById` (con nuevo ID) devuelve `Optional.empty()`.                                    | 1. Crear DTO con ID de profesor inválido. 2. Configurar Mocks. 3. Llamar a `activityService.update(dto)`.                          | Se lanza una `Exception` indicando que el profesor no fue encontrado.                                                                                                                            | Pendiente      |

---

### 4. Otros Métodos (Ej: `findAll`, `findById`, `deleteById`, `updateState`)

Estos casos no están completamente implementados en `ActivityTest`, pero deberían diseñarse:

| ID Caso | Nombre del Test (Método) | Descripción                                                  | Precondiciones (Mocks)                                           | Pasos                                            | Resultado Esperado                                                                    | Estado    |
| :------ | :----------------------- | :----------------------------------------------------------- | :--------------------------------------------------------------- | :----------------------------------------------- | :------------------------------------------------------------------------------------ | :-------- |
| ACT-014 | `testFindAll`            | Verifica que devuelve una lista de DTOs de actividades.      | `activityRepository.findAll` devuelve `List<Activity>`.          | Llamar a `activityService.findAll()`.            | Devuelve `List<ActivityDTO>` con tamaño y contenido correctos.                        | Pendiente |
| ACT-015 | `testFindById_Found`     | Verifica que devuelve un Optional con Activity si existe.    | `activityRepository.findById` devuelve `Optional.of(activity)`.  | Llamar a `activityService.findById(id)`.         | Devuelve `Optional` conteniendo la `Activity` correcta.                               | Pendiente |
| ACT-016 | `testFindById_NotFound`  | Verifica que devuelve un Optional vacío si no existe.        | `activityRepository.findById` devuelve `Optional.empty()`.       | Llamar a `activityService.findById(id)`.         | Devuelve `Optional.empty()`.                                                          | Pendiente |
| ACT-017 | `testDeleteById_Success` | Verifica que se llama al método delete del repositorio.      | `activityRepository.existsById` devuelve `true`.                 | Llamar a `activityService.deleteById(id)`.       | Se llama a `activityRepository.deleteById(id)` una vez. No lanza excepción.           | Pendiente |
| ACT-018 | `testDeleteById_NotFound`| Verifica que lanza excepción si la actividad no existe.      | `activityRepository.existsById` devuelve `false`.                | Llamar a `activityService.deleteById(id)`.       | Lanza `Exception` indicando que no se encontró. No se llama a `deleteById`.         | Pendiente |
| ACT-019 | `testUpdateState_Success`| Verifica la actualización de estado exitosa. (Implementado) | `activityRepository.findById` devuelve `Optional.of(activity)`.  | Llamar a `activityService.updateState(id)`.      | Se llama a `activityRepository.save()` con la actividad actualizada. Devuelve `true`. | Pendiente |
| ACT-020 | `testUpdateState_NotFound`| Verifica fallo si actividad no existe. (Implementado)      | `activityRepository.findById` devuelve `Optional.empty()`.       | Llamar a `activityService.updateState(id)`.      | Lanza `Exception`. No se llama a `activityRepository.save()`.                       | Pendiente |

---

**Notas:**

*   Los casos marcados como "Comentado" existen en el código pero están comentados. Necesitan ser descomentados y potencialmente ajustados a la lógica actual del servicio.
*   Los casos marcados como "Pendiente" representan funcionalidades importantes que deberían tener pruebas unitarias pero no están implementadas en `ActivityTest`.
*   El estado "OK" indica que el test existe y parece cubrir el caso descrito, asumiendo que la lógica del test es correcta.